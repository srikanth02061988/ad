-- Query to aggregate model latency by sessionId, traceId, and traceDate
WITH latency_data AS (
    SELECT 
        sessionId, 
        trace.traceId,
        to_date(traceTime) as traceDate,
        CAST(trace.value AS FLOAT) AS model_latency
    FROM 
        hive_metastore.default.rai_new_payload_v2
    WHERE 
        traceType = 'metric' 
        AND trace.attribute = 'modelLatency'
)
SELECT 
    sessionId,
    traceId,
    traceDate,
    model_latency
FROM 
    latency_data
ORDER BY 
    traceDate, sessionId, traceId;
