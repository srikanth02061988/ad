def main():
    st.set_page_config(page_title="Digital Marketing")
    st.header("Generate Derivative Content")
    st.sidebar.title("Menu")

    # Upload PDF file
    pdf_docs = st.sidebar.file_uploader("Upload your PDF Files", type=["pdf"])
    
    # Button to submit and process the uploaded PDF
    if pdf_docs is not None and st.sidebar.button("Submit and Process"):
        with st.spinner("Processing..."):
            raw_text = get_pdf_text(pdf_docs)
            if raw_text:
                text_chunks = get_text_chunks(raw_text)
                pdf_id = str(uuid.uuid4())
                store_embeddings_in_db(pdf_id, text_chunks, azure_endpoint, headers)
                st.session_state["pdf_id"] = pdf_id
                st.sidebar.success("Done")
            else:
                logger.error("No text extracted from PDF.")
                st.error("Failed to extract text from the uploaded PDF.")

    if "pdf_id" in st.session_state:
        category = st.selectbox("Select the category to search within:", ["Twitter", "LinkedIn", "Other"])
        user_question = st.text_area("Ask a Question based on the uploaded PDF", height=200)
        # Direct submit button for questions
        if st.button("Submit Question"):
            with st.spinner("Retrieving and processing..."):
                pdf_id = st.session_state["pdf_id"]
                docs, embeddings = retrieve_embeddings_from_db(pdf_id)
                if docs and embeddings is not None and embeddings.any():
                    relevant_docs = find_relevant_chunks(user_question, docs, embeddings)
                    text_response = generate_responses(user_question, relevant_docs, client)
                    if text_response:
                        st.write("Response:")
                        st.write(text_response)
                        st.download_button("Download Response", data=text_response, file_name="response.txt")
                    else:
                        st.error("Failed to generate responses.")
                else:
                    st.error("No relevant embeddings found for the uploaded PDF.")

if __name__ == "__main__":
    main()

