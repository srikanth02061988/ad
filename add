-- Main SQL query with both jailbreakAttempt and guardrailAttempt, handling null values
WITH attempts AS (
    SELECT 
        to_date(traceTime) as traceDate, 
        attribute,
        CAST(trace.value AS FLOAT) AS value
    FROM 
        hive_metastore.default.rai_new_payload_v2
    WHERE 
        traceType = 'metric' 
        AND (trace.attribute = 'jailbreakAttempt' OR trace.attribute = 'guardrailAttempt')
)
SELECT 
    traceDate,
    attribute,
    SUM(value) AS total_attempts
FROM 
    attempts
GROUP BY 
    traceDate, attribute
ORDER BY 
    traceDate, attribute;
