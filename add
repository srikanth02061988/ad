from pyspark.sql import SparkSession

spark = SparkSession.builder \
    .appName("RemoveColumnFromDeltaTable") \
    .getOrCreate()

delta_table = spark.read.format("delta").load("dbfs:/user/hive/warehouse/rai_payload_synth_hallucination_results")

print("Schema before dropping column:")
delta_table.printSchema()

if 'event_timestamp' in delta_table.columns:
    delta_table = delta_table.drop("event_timestamp")
    print("Dropped 'event_timestamp' column from the Delta table.")
else:
    print("'event_timestamp' column does not exist in the Delta table.")

delta_table.write.format("delta").option("mergeSchema", "true").mode("overwrite").save("dbfs:/user/hive/warehouse/rai_payload_synth_hallucination_results")

updated_table = spark.read.format("delta").load("dbfs:/user/hive/warehouse/rai_payload_synth_hallucination_results")
print("Schema after dropping column:")
updated_table.printSchema()

print("Updated Delta table saved without 'event_timestamp' column.")
