results_df = spark.createDataFrame(all_results)
print("Converted results to DataFrame.")

# Save results to Delta table with schema merging enabled
results_df.select(
    "timestamp", 
    "ssc_RAI_session_id", 
    "ssc_RAI_chainid", 
    "ssc_RAI_appcode", 
    "hallucination_score", 
    "is_hallucination"
).write.format("delta").option("mergeSchema", "true").mode("overwrite").save("dbfs:/user/hive/warehouse/rai_payload_synth_hallucination_results")

print("Saved results to Delta table with 'timestamp'.")
