import openai

# Azure OpenAI configuration
openai.api_type = "azure"
openai.api_version = "2024-02-01"
openai.base_url = "https://your-api-endpoint.azure.com/"
api_key = "your-api-key"

input_text = "Who were the founders of Microsoft?"
output_text = "Microsoft was founded by Bill Gates and Paul Allen."

system_prompt = """
You are an AI assistant tasked with detecting open-domain hallucinations in the following response.
An open-domain hallucination is an inaccurate or unmotivated claim about the world.
Please answer with "Yes" or "No" and provide a brief explanation.

Input: {input_text}
Response: {output_text}
Does the response contain open-domain hallucinations? Explain your reasoning.
"""

def call_llm_model(client, prompt):
    response = client.chat.completions.create(
        model="ajitTest",
        messages=[
            {"role": "system", "content": "Assistant is a large language model trained by OpenAI."},
            {"role": "user", "content": prompt}
        ]
    )
    return response.choices[0].message['content'].strip()

def detect_hallucinations(client, input_text, output_text, num_responses=5):
    hallucination_count = 0
    prompt = system_prompt.format(input_text=input_text, output_text=output_text)
    responses = []

    try:
        for _ in range(num_responses):
            response = call_llm_model(client, prompt)
            responses.append(response)
            print(f"Response {_ + 1}: {response}")
            if "yes" in response.lower():
                hallucination_count += 1
    except Exception as e:
        print(f"An error occurred while generating responses: {e}")
        return False, 0.0

    hallucination_score = hallucination_count / num_responses
    is_hallucination = hallucination_score > 0.5

    return is_hallucination, hallucination_score

client = openai.OpenAI(api_key=api_key)  # Pass the api_key directly when creating the OpenAI client

is_hallucination, score = detect_hallucinations(client, input_text, output_text)

print(f"\nFinal Result:")
print(f"Input: {input_text}")
print(f"Output: {output_text}")
print(f"Is Hallucination: {is_hallucination}")
print(f"Hallucination Score: {score}")

